# ğŸ¯ Windows ä¸ªäººç¿»è¯‘å­¦ä¹ å·¥å…· - å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ v2.0

## ä¸€ã€é¡¹ç›®å®šä½ä¸æ ¸å¿ƒä»·å€¼

### 1.1 äº§å“å®šä½

ä¸€ä¸ª**è½»é‡çº§ã€é«˜æ•ˆã€æ™ºèƒ½**çš„ Windows æ¡Œé¢ç¿»è¯‘å­¦ä¹ å·¥å…·ï¼Œä¸“æ³¨äºï¼š

- **å³æ—¶ç¿»è¯‘**ï¼šä»»ä½•ä½ç½®ï¼Œä¸€é”®å–è¯ï¼Œç§’çº§å“åº”
- **æ™ºèƒ½ç§¯ç´¯**ï¼šè‡ªåŠ¨æ„å»ºä¸ªäººä¸“å±è¯åº“
- **ç§‘å­¦å¤ä¹ **ï¼šåŸºäºé—å¿˜æ›²çº¿çš„è®°å¿†å¼ºåŒ–
- **éšç§ä¼˜å…ˆ**ï¼šæœ¬åœ°å­˜å‚¨ï¼Œæ•°æ®è‡ªä¸»å¯æ§

### 1.2 æ ¸å¿ƒç«äº‰åŠ›

- ğŸš€ **æ— æ„Ÿä½“éªŒ**ï¼šå…¨å±€çƒ­é”®ï¼Œä¸æ‰“æ–­å·¥ä½œæµ
- ğŸ§  **æ™ºèƒ½å¼•æ“**ï¼šè¯å…¸+AIæ··åˆï¼Œç²¾å‡†ä¸”ç»æµ
- ğŸ“Š **æ•°æ®é©±åŠ¨**ï¼šå­¦ä¹ åˆ†æï¼Œå¯è§†åŒ–è¿›æ­¥
- ğŸ¨ **ç°ä»£è®¾è®¡**ï¼šç®€æ´ç¾è§‚ï¼Œç¬¦åˆ Windows 11 è®¾è®¡è¯­è¨€

---

## äºŒã€å®Œæ•´æ¶æ„è®¾è®¡

### 2.1 æŠ€æœ¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·äº¤äº’å±‚ (UI Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‚¬æµ®ç¿»è¯‘çª—å£  â”‚  ä¸»çª—å£  â”‚  è®¾ç½®é¢æ¿  â”‚  ç»Ÿè®¡ä»ªè¡¨æ¿  â”‚  æ‰˜ç›˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚ (Service Layer)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çƒ­é”®ç®¡ç†  â”‚  å–è¯å¼•æ“  â”‚  ç¿»è¯‘è°ƒåº¦  â”‚  å­¦ä¹ ç®—æ³•  â”‚  åŒæ­¥æœåŠ¡  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   æ•°æ®è®¿é—®å±‚ (Data Layer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¯åº“ç®¡ç†  â”‚  ç¼“å­˜ç³»ç»Ÿ  â”‚  é…ç½®ç®¡ç†  â”‚  æ—¥å¿—ç³»ç»Ÿ  â”‚  å¤‡ä»½æ¢å¤  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœ¬åœ°è¯å…¸  â”‚  SQLite  â”‚  APIç½‘å…³  â”‚  æ–‡ä»¶ç³»ç»Ÿ  â”‚  ç³»ç»Ÿé›†æˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæŠ€æœ¯æ ˆ

| å±‚æ¬¡          | æŠ€æœ¯é€‰å‹               | è¯´æ˜         | å¤‡é€‰æ–¹æ¡ˆ           |
| ----------- | ------------------ | ---------- | -------------- |
| **GUIæ¡†æ¶**   | PyQt6              | æˆç†Ÿã€è·¨å¹³å°ã€é«˜æ€§èƒ½ | PySide6        |
| **çƒ­é”®ç›‘å¬**    | pynput             | ç¨³å®šã€è·¨å¹³å°     | keyboard       |
| **å‰ªè´´æ¿**     | pyperclip          | ç®€å•å¯é        | win32clipboard |
| **æ•°æ®åº“**     | SQLite3 + FTS5     | è½»é‡ã€æ”¯æŒå…¨æ–‡æœç´¢  | -              |
| **HTTPå®¢æˆ·ç«¯** | httpx              | å¼‚æ­¥æ”¯æŒã€ç°ä»£åŒ–   | aiohttp        |
| **é…ç½®ç®¡ç†**    | pydantic + TOML    | ç±»å‹å®‰å…¨ã€æ˜“è¯»    | JSON           |
| **æ—¥å¿—**      | loguru             | ç®€æ´å¼ºå¤§       | logging        |
| **OCR**     | PaddleOCR-Lite     | ç¦»çº¿ã€è½»é‡      | EasyOCR        |
| **TTS**     | edge-tts           | å…è´¹ã€é«˜è´¨é‡     | pyttsx3        |
| **æ‰“åŒ…**      | PyInstaller        | æˆç†Ÿç¨³å®š       | Nuitka         |
| **AIæ¥å£**    | DashScope / OpenAI | çµæ´»åˆ‡æ¢       | æœ¬åœ°Ollama       |

---

## ä¸‰ã€è¯¦ç»†åŠŸèƒ½è®¾è®¡

### 3.1 å–è¯ç³»ç»Ÿï¼ˆä¸‰ç§æ¨¡å¼ï¼‰

#### æ¨¡å¼ä¸€ï¼šæ™ºèƒ½çƒ­é”®å–è¯ï¼ˆæ¨è â­â­â­â­â­ï¼‰

```python
è§¦å‘æµç¨‹ï¼š
1. ç”¨æˆ·é€‰ä¸­æ–‡æœ¬
2. æŒ‰ä¸‹ Ctrl+Qï¼ˆå¯è‡ªå®šä¹‰ï¼‰
3. ç³»ç»Ÿï¼š
   - å¤‡ä»½å‰ªè´´æ¿
   - æ¨¡æ‹Ÿ Ctrl+C
   - è·å–é€‰ä¸­æ–‡æœ¬
   - æ¢å¤å‰ªè´´æ¿
   - åœ¨é¼ æ ‡ä½ç½®æ˜¾ç¤ºç¿»è¯‘å¼¹çª—
4. ç”¨æˆ·ï¼šæŸ¥çœ‹/æ”¶è—/å…³é—­

ä¼˜ç‚¹ï¼š
- ä¸æ±¡æŸ“å‰ªè´´æ¿
- ç²¾ç¡®æ§åˆ¶
- å…¼å®¹æ€§æœ€å¥½
```

#### æ¨¡å¼äºŒï¼šå‰ªè´´æ¿æ™ºèƒ½ç›‘å¬ï¼ˆè¾…åŠ© â­â­â­â­ï¼‰

```python
è§¦å‘æµç¨‹ï¼š
1. ç”¨æˆ·å¤åˆ¶æ–‡æœ¬ï¼ˆCtrl+Cï¼‰
2. ç³»ç»Ÿæ£€æµ‹å‰ªè´´æ¿å˜åŒ–
3. æ™ºèƒ½åˆ¤æ–­ï¼š
   - è¿‡æ»¤ç³»ç»Ÿå‰ªè´´æ¿ï¼ˆæ–‡ä»¶è·¯å¾„ã€å›¾ç‰‡ç­‰ï¼‰
   - è¿‡æ»¤é‡å¤å†…å®¹
   - è¿‡æ»¤è¶…é•¿æ–‡æœ¬ï¼ˆ>1000å­—ç¬¦ï¼‰
4. è‡ªåŠ¨æ˜¾ç¤ºç¿»è¯‘ï¼ˆå»¶è¿Ÿ0.3ç§’ï¼Œé¿å…è¯¯è§¦ï¼‰

ä¼˜ç‚¹ï¼š
- é›¶å­¦ä¹ æˆæœ¬
- é€‚åˆå¤§é‡å¤åˆ¶åœºæ™¯
```

#### æ¨¡å¼ä¸‰ï¼šæˆªå›¾OCRå–è¯ï¼ˆé«˜çº§ â­â­â­ï¼‰

```python
è§¦å‘æµç¨‹ï¼š
1. æŒ‰ä¸‹ Ctrl+Shift+Q
2. å±å¹•æˆªå›¾é®ç½©
3. æ¡†é€‰åŒºåŸŸ
4. OCRè¯†åˆ«æ–‡æœ¬
5. æ˜¾ç¤ºç¿»è¯‘

ä¼˜ç‚¹ï¼š
- æ”¯æŒå›¾ç‰‡ä¸­çš„æ–‡å­—
- æ”¯æŒPDFã€è§†é¢‘å­—å¹•
```

### 3.2 ç¿»è¯‘å¼•æ“ï¼ˆæ™ºèƒ½è°ƒåº¦ï¼‰

#### å†³ç­–æ ‘é€»è¾‘

```python
def choose_translator(text: str) -> TranslatorType:
    """æ™ºèƒ½é€‰æ‹©ç¿»è¯‘å™¨"""

    # 1. ç”¨æˆ·å¼ºåˆ¶æ¨¡å¼
    if config.force_ai_mode:
        return TranslatorType.AI

    # 2. æ£€æµ‹è¯­è¨€
    lang = detect_language(text)

    # 3. åˆ¤æ–­æ–‡æœ¬ç±»å‹
    if is_single_word(text):
        # å•è¯ â†’ æœ¬åœ°è¯å…¸
        if exists_in_local_dict(text):
            return TranslatorType.LOCAL_DICT
        else:
            return TranslatorType.ONLINE_DICT  # æœ‰é“/é‡‘å±±

    elif is_simple_phrase(text):
        # 2-5ä¸ªè¯çš„çŸ­è¯­ â†’ åœ¨çº¿è¯å…¸
        return TranslatorType.ONLINE_DICT

    elif is_sentence(text):
        # å¥å­ â†’ AIç¿»è¯‘
        return TranslatorType.AI

    elif len(text) > 500:
        # æ®µè½/æ–‡ç«  â†’ AIç¿»è¯‘ï¼ˆåˆ†æ®µå¤„ç†ï¼‰
        return TranslatorType.AI_CHUNKED

    return TranslatorType.AI
```

#### ç¿»è¯‘å™¨æ¥å£è®¾è®¡

```python
class TranslatorInterface(ABC):
    @abstractmethod
    async def translate(self, text: str, source_lang: str, target_lang: str) -> TranslationResult:
        pass

    @abstractmethod
    def get_cache_key(self, text: str) -> str:
        pass

class LocalDictTranslator(TranslatorInterface):
    """æœ¬åœ°è¯å…¸ï¼ˆç§’çº§å“åº”ï¼‰"""
    pass

class OnlineDictTranslator(TranslatorInterface):
    """åœ¨çº¿è¯å…¸APIï¼ˆæœ‰é“/é‡‘å±±ï¼Œé€‚åˆå•è¯çŸ­è¯­ï¼‰"""
    pass

class AITranslator(TranslatorInterface):
    """AIç¿»è¯‘ï¼ˆOpenAI/DashScope/Ollamaï¼‰"""

    async def translate(self, text: str, source_lang: str, target_lang: str) -> TranslationResult:
        prompt = f"""è¯·å°†ä»¥ä¸‹{source_lang}æ–‡æœ¬ç¿»è¯‘æˆ{target_lang}ï¼Œè¦æ±‚ï¼š
1. å‡†ç¡®ä¼ è¾¾åŸæ„
2. ç¬¦åˆ{target_lang}è¡¨è¾¾ä¹ æƒ¯
3. å¦‚æœæ˜¯ä¸“ä¸šæœ¯è¯­ï¼Œæä¾›é¢†åŸŸè¯´æ˜

åŸæ–‡ï¼š
{text}

è¯·ä»¥JSONæ ¼å¼è¿”å›ï¼š
{{
    "translation": "ç¿»è¯‘ç»“æœ",
    "explanation": "è¡¥å……è¯´æ˜ï¼ˆå¯é€‰ï¼‰",
    "domain": "é¢†åŸŸæ ‡ç­¾ï¼ˆå¯é€‰ï¼‰"
}}
"""
        # è°ƒç”¨APIå¹¶è§£æç»“æœ
        pass
```

### 3.3 æ•°æ®åº“è®¾è®¡ï¼ˆå®Œæ•´ç‰ˆï¼‰

```sql
-- 1. è¯æ¡è¡¨ï¼ˆæ ¸å¿ƒï¼‰
CREATE TABLE entries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    source_text TEXT NOT NULL,
    translation TEXT NOT NULL,
    source_lang TEXT DEFAULT 'en',
    target_lang TEXT DEFAULT 'zh',
    entry_type TEXT DEFAULT 'sentence',  -- word/phrase/sentence/paragraph

    -- æ¥æºä¿¡æ¯
    context TEXT,                         -- ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
    source_app TEXT,                      -- æ¥æºåº”ç”¨ï¼ˆChrome/VSCodeç­‰ï¼‰
    source_url TEXT,                      -- æ¥æºURLï¼ˆå¦‚æœæœ‰ï¼‰

    -- å­¦ä¹ æ•°æ®
    familiarity INTEGER DEFAULT 0,        -- ç†Ÿæ‚‰åº¦ 0-5
    review_count INTEGER DEFAULT 0,       -- å¤ä¹ æ¬¡æ•°
    correct_count INTEGER DEFAULT 0,      -- ç­”å¯¹æ¬¡æ•°
    last_review DATETIME,                 -- ä¸Šæ¬¡å¤ä¹ æ—¶é—´
    next_review DATETIME,                 -- ä¸‹æ¬¡å¤ä¹ æ—¶é—´
    ease_factor REAL DEFAULT 2.5,         -- SM-2ç®—æ³•ï¼šéš¾åº¦ç³»æ•°
    interval INTEGER DEFAULT 0,           -- SM-2ç®—æ³•ï¼šé—´éš”å¤©æ•°

    -- å…ƒæ•°æ®
    tags TEXT,                            -- JSONæ•°ç»„ï¼š["å·¥ä½œ", "æŠ€æœ¯"]
    notes TEXT,                           -- ç”¨æˆ·ç¬”è®°
    translator_type TEXT,                 -- ä½¿ç”¨çš„ç¿»è¯‘å™¨ç±»å‹
    translation_time REAL,                -- ç¿»è¯‘è€—æ—¶ï¼ˆç§’ï¼‰

    -- æ—¶é—´æˆ³
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_deleted INTEGER DEFAULT 0,         -- è½¯åˆ é™¤

    -- å…¨æ–‡æœç´¢
    UNIQUE(source_text, source_lang, target_lang)
);

-- å…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆFTS5ï¼‰
CREATE VIRTUAL TABLE entries_fts USING fts5(
    source_text, 
    translation, 
    context,
    content='entries',
    content_rowid='id'
);

-- è§¦å‘å™¨ï¼šè‡ªåŠ¨æ›´æ–°FTSç´¢å¼•
CREATE TRIGGER entries_ai AFTER INSERT ON entries BEGIN
    INSERT INTO entries_fts(rowid, source_text, translation, context)
    VALUES (new.id, new.source_text, new.translation, new.context);
END;

-- ç´¢å¼•
CREATE INDEX idx_created_at ON entries(created_at DESC);
CREATE INDEX idx_next_review ON entries(next_review);
CREATE INDEX idx_familiarity ON entries(familiarity);
CREATE INDEX idx_tags ON entries(tags);

-- 2. æ ‡ç­¾è¡¨
CREATE TABLE tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE NOT NULL,
    color TEXT DEFAULT '#3B82F6',
    icon TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 3. ç»Ÿè®¡è¡¨ï¼ˆæ¯æ—¥ï¼‰
CREATE TABLE daily_stats (
    date DATE PRIMARY KEY,
    new_words INTEGER DEFAULT 0,
    reviews INTEGER DEFAULT 0,
    study_time INTEGER DEFAULT 0,  -- ç§’
    translation_count INTEGER DEFAULT 0,
    ai_calls INTEGER DEFAULT 0,
    ai_tokens INTEGER DEFAULT 0
);

-- 4. ç¿»è¯‘ç¼“å­˜è¡¨
CREATE TABLE translation_cache (
    cache_key TEXT PRIMARY KEY,
    source_text TEXT NOT NULL,
    translation TEXT NOT NULL,
    translator_type TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    expires_at DATETIME,
    hit_count INTEGER DEFAULT 0
);
CREATE INDEX idx_expires_at ON translation_cache(expires_at);

-- 5. é…ç½®è¡¨
CREATE TABLE settings (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 6. é»‘åå•è¡¨
CREATE TABLE blacklist (
    app_name TEXT PRIMARY KEY,
    reason TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 3.4 é…ç½®ç³»ç»Ÿï¼ˆconfig.tomlï¼‰

```toml
[app]
name = "TransLearn"
version = "1.0.0"
language = "zh_CN"
theme = "auto"  # light/dark/auto

[hotkey]
translate = "ctrl+q"
screenshot_ocr = "ctrl+shift+q"
toggle_monitor = "ctrl+shift+t"
open_main_window = "ctrl+shift+l"

[translation]
# ç¿»è¯‘å™¨ä¼˜å…ˆçº§
priority = ["local_dict", "online_dict", "ai"]
force_ai = false
auto_detect_language = true

# æ™ºèƒ½åˆ¤æ–­é˜ˆå€¼
word_threshold = 1          # â‰¤1ä¸ªè¯ â†’ è¯å…¸
phrase_threshold = 5        # 2-5ä¸ªè¯ â†’ åœ¨çº¿è¯å…¸
sentence_min_length = 10    # â‰¥10å­—ç¬¦ â†’ AI

[translation.ai]
provider = "dashscope"      # dashscope/openai/ollama
model = "qwen-turbo"
api_key = ""
base_url = ""
timeout = 15
max_tokens = 500
temperature = 0.3

[translation.online_dict]
provider = "youdao"         # youdao/iciba
api_key = ""
timeout = 5

[translation.local_dict]
enabled = true
path = "data/dict.db"

[ui.popup]
position = "mouse"          # mouse/center/top_right
offset_x = 10
offset_y = 10
width = 450
max_height = 600
opacity = 0.95
auto_hide = false
auto_hide_delay = 0         # 0=ä¸è‡ªåŠ¨éšè—
show_animation = true
theme = "auto"

[ui.main_window]
width = 1000
height = 700
default_view = "timeline"   # timeline/list/cards

[features]
clipboard_monitor = true
clipboard_delay = 300       # æ¯«ç§’
clipboard_filter_duplicates = true
clipboard_filter_paths = true
auto_save = true
auto_save_threshold = 3     # æŸ¥è¯¢3æ¬¡ä»¥ä¸Šè‡ªåŠ¨ä¿å­˜
play_sound = false
pronunciation = true
context_capture = true      # æ•è·æ¥æºä¿¡æ¯

[review]
algorithm = "sm2"           # sm2/fsrs
daily_goal = 50
notification_enabled = true
notification_time = "20:00"

[cache]
enabled = true
expire_days = 30
max_size_mb = 100

[blacklist]
apps = ["PasswordManager", "Bitwarden", "KeePass"]
auto_add = true

[data]
database_path = "data/user.db"
backup_enabled = true
backup_interval_days = 7
export_format = "csv"       # csv/json/anki

[performance]
max_concurrent_translations = 3
database_pool_size = 5
log_level = "INFO"          # DEBUG/INFO/WARNING/ERROR
```

---

## å››ã€é¡¹ç›®æ–‡ä»¶ç»“æ„ï¼ˆå®Œæ•´ç‰ˆï¼‰

```
TransLearn/
â”‚
â”œâ”€ ğŸ“ src/                          # æºä»£ç 
â”‚  â”œâ”€ ğŸ“„ __init__.py
â”‚  â”œâ”€ ğŸ“„ __main__.py                # å…¥å£ç‚¹
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“ ui/                        # ç”¨æˆ·ç•Œé¢
â”‚  â”‚  â”œâ”€ ğŸ“„ __init__.py
â”‚  â”‚  â”œâ”€ ğŸ“„ popup_window.py         # ç¿»è¯‘æ‚¬æµ®çª—
â”‚  â”‚  â”œâ”€ ğŸ“„ main_window.py          # ä¸»çª—å£
â”‚  â”‚  â”œâ”€ ğŸ“„ settings_dialog.py      # è®¾ç½®å¯¹è¯æ¡†
â”‚  â”‚  â”œâ”€ ğŸ“„ stats_dashboard.py      # ç»Ÿè®¡ä»ªè¡¨æ¿
â”‚  â”‚  â”œâ”€ ğŸ“„ review_window.py        # å¤ä¹ ç•Œé¢
â”‚  â”‚  â”œâ”€ ğŸ“„ tray_icon.py            # ç³»ç»Ÿæ‰˜ç›˜
â”‚  â”‚  â”œâ”€ ğŸ“„ widgets/                # è‡ªå®šä¹‰æ§ä»¶
â”‚  â”‚  â”‚  â”œâ”€ ğŸ“„ word_card.py
â”‚  â”‚  â”‚  â”œâ”€ ğŸ“„ tag_selector.py
â”‚  â”‚  â”‚  â””â”€ ğŸ“„ chart_widget.py
â”‚  â”‚  â””â”€ ğŸ“„ styles/                 # QSSæ ·å¼
â”‚  â”‚     â”œâ”€ ğŸ“„ light.qss
â”‚  â”‚     â””â”€ ğŸ“„ dark.qss
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“ core/                      # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚  â”‚  â”œâ”€ ğŸ“„ __init__.py
â”‚  â”‚  â”œâ”€ ğŸ“„ hotkey_manager.py       # çƒ­é”®ç®¡ç†
â”‚  â”‚  â”œâ”€ ğŸ“„ clipboard_monitor.py    # å‰ªè´´æ¿ç›‘å¬
â”‚  â”‚  â”œâ”€ ğŸ“„ text_extractor.py       # æ–‡æœ¬æå–ï¼ˆOCRï¼‰
â”‚  â”‚  â”œâ”€ ğŸ“„ translator_factory.py   # ç¿»è¯‘å™¨å·¥å‚
â”‚  â”‚  â”œâ”€ ğŸ“„ translator_interface.py # ç¿»è¯‘å™¨æ¥å£
â”‚  â”‚  â”œâ”€ ğŸ“„ local_dict_translator.py
â”‚  â”‚  â”œâ”€ ğŸ“„ online_dict_translator.py
â”‚  â”‚  â”œâ”€ ğŸ“„ ai_translator.py
â”‚  â”‚  â”œâ”€ ğŸ“„ language_detector.py    # è¯­è¨€æ£€æµ‹
â”‚  â”‚  â”œâ”€ ğŸ“„ smart_router.py         # æ™ºèƒ½è·¯ç”±
â”‚  â”‚  â”œâ”€ ğŸ“„ review_algorithm.py     # å¤ä¹ ç®—æ³•ï¼ˆSM-2ï¼‰
â”‚  â”‚  â””â”€ ğŸ“„ pronunciation.py        # å‘éŸ³æœåŠ¡
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“ data/                      # æ•°æ®è®¿é—®å±‚
â”‚  â”‚  â”œâ”€ ğŸ“„ __init__.py
â”‚  â”‚  â”œâ”€ ğŸ“„ database.py             # æ•°æ®åº“ç®¡ç†
â”‚  â”‚  â”œâ”€ ğŸ“„ models.py               # æ•°æ®æ¨¡å‹
â”‚  â”‚  â”œâ”€ ğŸ“„ repository.py           # ä»“å‚¨æ¨¡å¼
â”‚  â”‚  â”œâ”€ ğŸ“„ cache_manager.py        # ç¼“å­˜ç®¡ç†
â”‚  â”‚  â”œâ”€ ğŸ“„ migration.py            # æ•°æ®åº“è¿ç§»
â”‚  â”‚  â””â”€ ğŸ“„ backup_service.py       # å¤‡ä»½æ¢å¤
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“ services/                  # åº”ç”¨æœåŠ¡
â”‚  â”‚  â”œâ”€ ğŸ“„ __init__.py
â”‚  â”‚  â”œâ”€ ğŸ“„ translation_service.py  # ç¿»è¯‘æœåŠ¡ï¼ˆé—¨é¢ï¼‰
â”‚  â”‚  â”œâ”€ ğŸ“„ learning_service.py     # å­¦ä¹ æœåŠ¡
â”‚  â”‚  â”œâ”€ ğŸ“„ stats_service.py        # ç»Ÿè®¡æœåŠ¡
â”‚  â”‚  â”œâ”€ ğŸ“„ export_service.py       # å¯¼å‡ºæœåŠ¡
â”‚  â”‚  â””â”€ ğŸ“„ context_service.py      # ä¸Šä¸‹æ–‡æ•è·
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“ utils/                     # å·¥å…·å‡½æ•°
â”‚  â”‚  â”œâ”€ ğŸ“„ __init__.py
â”‚  â”‚  â”œâ”€ ğŸ“„ config_loader.py        # é…ç½®åŠ è½½å™¨
â”‚  â”‚  â”œâ”€ ğŸ“„ logger.py               # æ—¥å¿—å·¥å…·
â”‚  â”‚  â”œâ”€ ğŸ“„ validators.py           # éªŒè¯å™¨
â”‚  â”‚  â”œâ”€ ğŸ“„ formatters.py           # æ ¼å¼åŒ–å·¥å…·
â”‚  â”‚  â”œâ”€ ğŸ“„ system_info.py          # ç³»ç»Ÿä¿¡æ¯
â”‚  â”‚  â””â”€ ğŸ“„ decorators.py           # è£…é¥°å™¨
â”‚  â”‚
â”‚  â””â”€ ğŸ“ resources/                 # èµ„æºæ–‡ä»¶ï¼ˆç¼–è¯‘åï¼‰
â”‚     â”œâ”€ ğŸ“„ icons.qrc
â”‚     â””â”€ ğŸ“„ translations.qrc
â”‚
â”œâ”€ ğŸ“ data/                         # æ•°æ®ç›®å½•
â”‚  â”œâ”€ ğŸ“„ user.db                    # ç”¨æˆ·æ•°æ®åº“
â”‚  â”œâ”€ ğŸ“„ dict.db                    # æœ¬åœ°è¯å…¸
â”‚  â”œâ”€ ğŸ“„ config.toml                # ç”¨æˆ·é…ç½®
â”‚  â””â”€ ğŸ“ backups/                   # å¤‡ä»½ç›®å½•
â”‚
â”œâ”€ ğŸ“ assets/                       # é™æ€èµ„æº
â”‚  â”œâ”€ ğŸ“ icons/
â”‚  â”‚  â”œâ”€ ğŸ“„ app.ico
â”‚  â”‚  â”œâ”€ ğŸ“„ tray.png
â”‚  â”‚  â””â”€ ğŸ“ ui/
â”‚  â”œâ”€ ğŸ“ fonts/
â”‚  â””â”€ ğŸ“ sounds/
â”‚
â”œâ”€ ğŸ“ tests/                        # æµ‹è¯•
â”‚  â”œâ”€ ğŸ“„ __init__.py
â”‚  â”œâ”€ ğŸ“„ test_translator.py
â”‚  â”œâ”€ ğŸ“„ test_database.py
â”‚  â”œâ”€ ğŸ“„ test_hotkey.py
â”‚  â””â”€ ğŸ“ fixtures/
â”‚
â”œâ”€ ğŸ“ scripts/                      # è„šæœ¬
â”‚  â”œâ”€ ğŸ“„ build.py                   # æ‰“åŒ…è„šæœ¬
â”‚  â”œâ”€ ğŸ“„ setup_dev.py               # å¼€å‘ç¯å¢ƒè®¾ç½®
â”‚  â””â”€ ğŸ“„ import_dict.py             # å¯¼å…¥è¯å…¸
â”‚
â”œâ”€ ğŸ“ docs/                         # æ–‡æ¡£
â”‚  â”œâ”€ ğŸ“„ README.md
â”‚  â”œâ”€ ğŸ“„ ARCHITECTURE.md
â”‚  â”œâ”€ ğŸ“„ API.md
â”‚  â””â”€ ğŸ“„ CHANGELOG.md
â”‚
â”œâ”€ ğŸ“„ requirements.txt              # Pythonä¾èµ–
â”œâ”€ ğŸ“„ requirements-dev.txt          # å¼€å‘ä¾èµ–
â”œâ”€ ğŸ“„ pyproject.toml                # é¡¹ç›®é…ç½®
â”œâ”€ ğŸ“„ setup.py                      # å®‰è£…è„šæœ¬
â”œâ”€ ğŸ“„ .gitignore
â”œâ”€ ğŸ“„ LICENSE
â””â”€ ğŸ“„ README.md
```

---

## äº”ã€æ ¸å¿ƒä»£ç å®ç°ç¤ºä¾‹

### 5.1 æ™ºèƒ½ç¿»è¯‘æœåŠ¡ï¼ˆFacadeæ¨¡å¼ï¼‰

```python
# src/services/translation_service.py
from typing import Optional
import asyncio
from loguru import logger
from src.core.translator_factory import TranslatorFactory
from src.core.smart_router import SmartRouter
from src.data.cache_manager import CacheManager
from src.data.repository import EntryRepository
from src.utils.config_loader import config

class TranslationService:
    """ç¿»è¯‘æœåŠ¡é—¨é¢"""

    def __init__(self):
        self.factory = TranslatorFactory()
        self.router = SmartRouter()
        self.cache = CacheManager()
        self.repo = EntryRepository()

    async def translate(
        self,
        text: str,
        source_lang: Optional[str] = None,
        target_lang: str = "zh",
        save_to_db: bool = False,
        context: Optional[dict] = None
    ) -> TranslationResult:
        """
        ç¿»è¯‘æ–‡æœ¬

        Args:
            text: å¾…ç¿»è¯‘æ–‡æœ¬
            source_lang: æºè¯­è¨€ï¼ˆNone=è‡ªåŠ¨æ£€æµ‹ï¼‰
            target_lang: ç›®æ ‡è¯­è¨€
            save_to_db: æ˜¯å¦ä¿å­˜åˆ°æ•°æ®åº“
            context: ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆæ¥æºã€URLç­‰ï¼‰
        """
        try:
            # 1. å‚æ•°éªŒè¯
            text = text.strip()
            if not text:
                raise ValueError("æ–‡æœ¬ä¸èƒ½ä¸ºç©º")

            # 2. æ£€æŸ¥ç¼“å­˜
            cache_key = self.cache.generate_key(text, source_lang, target_lang)
            cached = await self.cache.get(cache_key)
            if cached:
                logger.info(f"å‘½ä¸­ç¼“å­˜: {text[:20]}...")
                return cached

            # 3. è¯­è¨€æ£€æµ‹
            if not source_lang:
                source_lang = await self.router.detect_language(text)

            # 4. æ™ºèƒ½è·¯ç”±é€‰æ‹©ç¿»è¯‘å™¨
            translator_type = self.router.choose_translator(text, source_lang)
            translator = self.factory.get_translator(translator_type)

            logger.info(f"ä½¿ç”¨ç¿»è¯‘å™¨: {translator_type.value} | æ–‡æœ¬: {text[:30]}...")

            # 5. æ‰§è¡Œç¿»è¯‘
            start_time = asyncio.get_event_loop().time()
            result = await translator.translate(text, source_lang, target_lang)
            elapsed = asyncio.get_event_loop().time() - start_time

            result.translator_type = translator_type.value
            result.translation_time = elapsed

            # 6. ç¼“å­˜ç»“æœ
            await self.cache.set(cache_key, result)

            # 7. ä¿å­˜åˆ°æ•°æ®åº“
            if save_to_db or self._should_auto_save(text):
                await self._save_entry(text, result, context)

            # 8. æ›´æ–°ç»Ÿè®¡
            await self._update_stats(translator_type, elapsed)

            logger.success(f"ç¿»è¯‘å®Œæˆï¼Œè€—æ—¶ {elapsed:.2f}s")
            return result

        except Exception as e:
            logger.error(f"ç¿»è¯‘å¤±è´¥: {e}")
            raise

    def _should_auto_save(self, text: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥è‡ªåŠ¨ä¿å­˜"""
        if not config.features.auto_save:
            return False

        # æŸ¥è¯¢å†å²æ¬¡æ•°
        count = self.repo.get_query_count(text)
        return count >= config.features.auto_save_threshold

    async def _save_entry(self, text: str, result: TranslationResult, context: Optional[dict]):
        """ä¿å­˜è¯æ¡"""
        entry = Entry(
            source_text=text,
            translation=result.translation,
            source_lang=result.source_lang,
            target_lang=result.target_lang,
            entry_type=result.entry_type,
            translator_type=result.translator_type,
            translation_time=result.translation_time,
            context=context.get('text') if context else None,
            source_app=context.get('app') if context else None,
            source_url=context.get('url') if context else None,
        )
        await self.repo.save(entry)
```

### 5.2 çƒ­é”®ç®¡ç†å™¨

```python
# src/core/hotkey_manager.py
from pynput import keyboard
import pyperclip
import pyautogui
import time
from typing import Callable
from loguru import logger
from src.utils.config_loader import config

class HotkeyManager:
    """å…¨å±€çƒ­é”®ç®¡ç†å™¨"""

    def __init__(self):
        self.listener = None
        self.callbacks = {}
        self._current_keys = set()

    def register(self, hotkey: str, callback: Callable):
        """
        æ³¨å†Œçƒ­é”®

        Args:
            hotkey: çƒ­é”®å­—ç¬¦ä¸²ï¼Œå¦‚ "ctrl+q"
            callback: å›è°ƒå‡½æ•°
        """
        keys = self._parse_hotkey(hotkey)
        self.callbacks[frozenset(keys)] = callback
        logger.info(f"æ³¨å†Œçƒ­é”®: {hotkey}")

    def start(self):
        """å¯åŠ¨ç›‘å¬"""
        self.listener = keyboard.Listener(
            on_press=self._on_press,
            on_release=self._on_release
        )
        self.listener.start()
        logger.info("çƒ­é”®ç›‘å¬å·²å¯åŠ¨")

    def stop(self):
        """åœæ­¢ç›‘å¬"""
        if self.listener:
            self.listener.stop()
            logger.info("çƒ­é”®ç›‘å¬å·²åœæ­¢")

    def _on_press(self, key):
        """æŒ‰é”®æŒ‰ä¸‹"""
        try:
            # è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
            key_name = self._get_key_name(key)
            self._current_keys.add(key_name)

            # æ£€æŸ¥æ˜¯å¦åŒ¹é…å·²æ³¨å†Œçš„çƒ­é”®
            current = frozenset(self._current_keys)
            if current in self.callbacks:
                callback = self.callbacks[current]
                callback()

        except Exception as e:
            logger.error(f"çƒ­é”®å¤„ç†é”™è¯¯: {e}")

    def _on_release(self, key):
        """æŒ‰é”®é‡Šæ”¾"""
        try:
            key_name = self._get_key_name(key)
            self._current_keys.discard(key_name)
        except:
            pass

    def _get_key_name(self, key) -> str:
        """è·å–æŒ‰é”®åç§°"""
        if isinstance(key, keyboard.KeyCode):
            return key.char.lower() if key.char else str(key)
        else:
            return key.name.lower()

    def _parse_hotkey(self, hotkey: str) -> list:
        """è§£æçƒ­é”®å­—ç¬¦ä¸²"""
        parts = hotkey.lower().split('+')
        keys = []
        for part in parts:
            if part == 'ctrl':
                keys.append('ctrl_l')  # æˆ– 'ctrl'
            elif part == 'shift':
                keys.append('shift')
            elif part == 'alt':
                keys.append('alt_l')
            else:
                keys.append(part)
        return keys

class TextExtractor:
    """æ–‡æœ¬æå–å™¨ï¼ˆå–è¯åŠŸèƒ½ï¼‰"""

    @staticmethod
    def extract_selected_text() -> str:
        """
        æå–å½“å‰é€‰ä¸­çš„æ–‡æœ¬ï¼ˆä¸æ±¡æŸ“å‰ªè´´æ¿ï¼‰

        Returns:
            é€‰ä¸­çš„æ–‡æœ¬
        """
        try:
            # 1. å¤‡ä»½å‰ªè´´æ¿
            old_clipboard = pyperclip.paste()

            # 2. æ¨¡æ‹Ÿå¤åˆ¶
            pyautogui.hotkey('ctrl', 'c')
            time.sleep(0.1)  # ç­‰å¾…ç³»ç»Ÿå“åº”

            # 3. è·å–æ–°å†…å®¹
            new_text = pyperclip.paste()

            # 4. æ¢å¤å‰ªè´´æ¿
            pyperclip.copy(old_clipboard)

            # 5. è¿”å›ç»“æœ
            if new_text and new_text != old_clipboard:
                logger.debug(f"æå–æ–‡æœ¬: {new_text[:50]}...")
                return new_text.strip()

            return ""

        except Exception as e:
            logger.error(f"æ–‡æœ¬æå–å¤±è´¥: {e}")
            return ""
```

### 5.3 ç¿»è¯‘æ‚¬æµ®çª—

```python
# src/ui/popup_window.py
from PyQt6.QtWidgets import *
from PyQt6.QtCore import *
from PyQt6.QtGui import *
from src.services.translation_service import TranslationService

class PopupWindow(QWidget):
    """ç¿»è¯‘ç»“æœæ‚¬æµ®çª—"""

    def __init__(self):
        super().__init__()
        self.translation_service = TranslationService()
        self.init_ui()

    def init_ui(self):
        """åˆå§‹åŒ–ç•Œé¢"""
        # çª—å£å±æ€§
        self.setWindowFlags(
            Qt.WindowType.FramelessWindowHint |      # æ— è¾¹æ¡†
            Qt.WindowType.WindowStaysOnTopHint |     # ç½®é¡¶
            Qt.WindowType.Tool                        # ä¸æ˜¾ç¤ºä»»åŠ¡æ 
        )
        self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground)  # é€æ˜èƒŒæ™¯

        # è®¾ç½®å°ºå¯¸
        self.setFixedWidth(450)
        self.setMaximumHeight(600)

        # ä¸»å¸ƒå±€
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)

        # å†…å®¹å®¹å™¨ï¼ˆå¸¦åœ†è§’å’Œé˜´å½±ï¼‰
        self.container = QFrame()
        self.container.setObjectName("popupContainer")
        self.container.setStyleSheet("""
            #popupContainer {
                background: white;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
            }
        """)

        # æ·»åŠ é˜´å½±æ•ˆæœ
        shadow = QGraphicsDropShadowEffect()
        shadow.setBlurRadius(20)
        shadow.setColor(QColor(0, 0, 0, 40))
        shadow.setOffset(0, 4)
        self.container.setGraphicsEffect(shadow)

        container_layout = QVBoxLayout(self.container)
        container_layout.setContentsMargins(16, 12, 16, 12)
        container_layout.setSpacing(12)

        # æ ‡é¢˜æ 
        header = self._create_header()
        container_layout.addWidget(header)

        # åŸæ–‡
        self.source_label = QLabel()
        self.source_label.setWordWrap(True)
        self.source_label.setStyleSheet("""
            QLabel {
                color: #6b7280;
                font-size: 14px;
                padding: 8px;
                background: #f9fafb;
                border-radius: 6px;
            }
        """)
        container_layout.addWidget(self.source_label)

        # ç¿»è¯‘ç»“æœ
        self.translation_label = QLabel()
        self.translation_label.setWordWrap(True)
        self.translation_label.setTextInteractionFlags(
            Qt.TextInteractionFlag.TextSelectableByMouse
        )
        self.translation_label.setStyleSheet("""
            QLabel {
                color: #111827;
                font-size: 16px;
                padding: 12px;
                line-height: 1.6;
            }
        """)
        container_layout.addWidget(self.translation_label)

        # åº•éƒ¨æ“ä½œæ 
        actions = self._create_actions()
        container_layout.addWidget(actions)

        layout.addWidget(self.container)

    def _create_header(self) -> QWidget:
        """åˆ›å»ºæ ‡é¢˜æ """
        header = QWidget()
        layout = QHBoxLayout(header)
        layout.setContentsMargins(0, 0, 0, 0)

        # æ ‡é¢˜
        title = QLabel("ç¿»è¯‘")
        title.setStyleSheet("font-size: 13px; color: #6b7280; font-weight: 500;")
        layout.addWidget(title)

        layout.addStretch()

        # å…³é—­æŒ‰é’®
        close_btn = QPushButton("Ã—")
        close_btn.setFixedSize(24, 24)
        close_btn.setCursor(Qt.CursorShape.PointingHandCursor)
        close_btn.setStyleSheet("""
            QPushButton {
                background: transparent;
                border: none;
                font-size: 20px;
                color: #9ca3af;
                border-radius: 4px;
            }
            QPushButton:hover {
                background: #f3f4f6;
                color: #6b7280;
            }
        """)
        close_btn.clicked.connect(self.hide)
        layout.addWidget(close_btn)

        return header

    def _create_actions(self) -> QWidget:
        """åˆ›å»ºæ“ä½œæŒ‰é’®"""
        actions = QWidget()
        layout = QHBoxLayout(actions)
        layout.setContentsMargins(0, 8, 0, 0)
        layout.setSpacing(8)

        # å‘éŸ³æŒ‰é’®
        pronounce_btn = self._create_action_button("ğŸ”Š", "å‘éŸ³")
        pronounce_btn.clicked.connect(self._on_pronounce)
        layout.addWidget(pronounce_btn)

        # æ”¶è—æŒ‰é’®
        save_btn = self._create_action_button("â­", "æ”¶è—")
        save_btn.clicked.connect(self._on_save)
        layout.addWidget(save_btn)

        # å¤åˆ¶æŒ‰é’®
        copy_btn = self._create_action_button("ğŸ“‹", "å¤åˆ¶")
        copy_btn.clicked.connect(self._on_copy)
        layout.addWidget(copy_btn)

        layout.addStretch()

        return actions

    def _create_action_button(self, icon: str, text: str) -> QPushButton:
        """åˆ›å»ºæ“ä½œæŒ‰é’®"""
        btn = QPushButton(f"{icon} {text}")
        btn.setCursor(Qt.CursorShape.PointingHandCursor)
        btn.setStyleSheet("""
            QPushButton {
                background: #f3f4f6;
                border: none;
                border-radius: 6px;
                padding: 6px 12px;
                font-size: 13px;
                color: #374151;
            }
            QPushButton:hover {
                background: #e5e7eb;
            }
            QPushButton:pressed {
                background: #d1d5db;
            }
        """)
        return btn

    async def show_translation(self, text: str):
        """æ˜¾ç¤ºç¿»è¯‘ç»“æœ"""
        # æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        self.source_label.setText(text)
        self.translation_label.setText("ç¿»è¯‘ä¸­...")
        self.show_at_cursor()

        # æ‰§è¡Œç¿»è¯‘
        result = await self.translation_service.translate(text)

        # æ›´æ–°UI
        self.translation_label.setText(result.translation)
        self.adjustSize()

    def show_at_cursor(self):
        """åœ¨é¼ æ ‡ä½ç½®æ˜¾ç¤º"""
        cursor_pos = QCursor.pos()

        # åç§»é‡
        offset_x = 10
        offset_y = 10

        # è®¡ç®—ä½ç½®ï¼ˆç¡®ä¿ä¸è¶…å‡ºå±å¹•ï¼‰
        screen = QApplication.primaryScreen().geometry()
        x = min(cursor_pos.x() + offset_x, screen.width() - self.width() - 20)
        y = min(cursor_pos.y() + offset_y, screen.height() - self.height() - 20)

        self.move(x, y)
        self.show()
        self.raise_()
        self.activateWindow()

    def keyPressEvent(self, event):
        """æŒ‰é”®äº‹ä»¶"""
        if event.key() == Qt.Key.Key_Escape:
            self.hide()
```

---

## å…­ã€å¼€å‘è®¡åˆ’ï¼ˆè¯¦ç»†æ’æœŸï¼‰

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒMVPï¼ˆ7å¤©ï¼‰

| å¤©æ•°    | ä»»åŠ¡            | äº¤ä»˜ç‰©                     |
| ----- | ------------- | ----------------------- |
| Day 1 | é¡¹ç›®æ­å»º + é…ç½®ç³»ç»Ÿ   | å®Œæ•´ç›®å½•ç»“æ„ + config.toml    |
| Day 2 | æ•°æ®åº“è®¾è®¡ + ORMå°è£… | database.py + models.py |
| Day 3 | çƒ­é”®ç®¡ç† + æ–‡æœ¬æå–   | å¯ä»¥å…¨å±€å–è¯                  |
| Day 4 | AIç¿»è¯‘æ¥å£é›†æˆ      | èƒ½è°ƒç”¨APIç¿»è¯‘                |
| Day 5 | ç¿»è¯‘æ‚¬æµ®çª—         | ç¾è§‚çš„å¼¹çª—                   |
| Day 6 | åŸºç¡€å­¦ä¹ åº“ç•Œé¢       | åˆ—è¡¨æŸ¥çœ‹/æœç´¢                 |
| Day 7 | æ‰˜ç›˜ + æ‰“åŒ…       | å¯æ‰§è¡Œçš„exe                 |

**é‡Œç¨‹ç¢‘**ï¼šèƒ½ç”¨çƒ­é”®å–è¯ã€ç¿»è¯‘ã€æ”¶è—

### é˜¶æ®µäºŒï¼šä½“éªŒä¼˜åŒ–ï¼ˆ7å¤©ï¼‰

| å¤©æ•°        | ä»»åŠ¡                 |
| --------- | ------------------ |
| Day 8-9   | æœ¬åœ°è¯å…¸ + åœ¨çº¿è¯å…¸ + æ™ºèƒ½è·¯ç”± |
| Day 10    | å‰ªè´´æ¿ç›‘å¬ + é»‘åå•        |
| Day 11    | ç¿»è¯‘ç¼“å­˜ + æ€§èƒ½ä¼˜åŒ–        |
| Day 12-13 | ä¸»çª—å£UIå®Œå–„ï¼ˆæ ‡ç­¾ã€ç­›é€‰ã€æ’åºï¼‰  |
| Day 14    | ç»Ÿè®¡é¢æ¿ + æ•°æ®å¯è§†åŒ–       |

**é‡Œç¨‹ç¢‘**ï¼šä½“éªŒæµç•…ï¼ŒåŠŸèƒ½å®Œæ•´

### é˜¶æ®µä¸‰ï¼šé«˜çº§åŠŸèƒ½ï¼ˆ7å¤©ï¼‰

| å¤©æ•°        | ä»»åŠ¡              |
| --------- | --------------- |
| Day 15-16 | OCRæˆªå›¾å–è¯         |
| Day 17    | å‘éŸ³ + å¯¼å‡ºåŠŸèƒ½       |
| Day 18-19 | SM-2å¤ä¹ ç®—æ³• + å¤ä¹ ç•Œé¢ |
| Day 20    | å¤‡ä»½æ¢å¤ + è‡ªåŠ¨æ›´æ–°     |
| Day 21    | æµ‹è¯• + æ–‡æ¡£ + å‘å¸ƒ    |

**é‡Œç¨‹ç¢‘**ï¼šç”Ÿäº§çº§äº§å“

---

## ä¸ƒã€å…³é”®æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 7.1 å…¨å±€çƒ­é”®å†²çª

**é—®é¢˜**ï¼šå¯èƒ½ä¸ç³»ç»Ÿæˆ–å…¶ä»–è½¯ä»¶å¿«æ·é”®å†²çª

**è§£å†³æ–¹æ¡ˆ**ï¼š

- æä¾›å¿«æ·é”®å†²çªæ£€æµ‹
- å…è®¸ç”¨æˆ·è‡ªå®šä¹‰å¿«æ·é”®
- æä¾›å¤‡ç”¨æ–¹æ¡ˆï¼ˆé¼ æ ‡ä¸­é”®ã€ä¾§é”®ï¼‰

### 7.2 å‰ªè´´æ¿æ±¡æŸ“

**é—®é¢˜**ï¼šå–è¯æ—¶ä¼šè¦†ç›–ç”¨æˆ·å‰ªè´´æ¿

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# ä¸‰æ˜æ²»æ³•ï¼šå¤‡ä»½ â†’ æ“ä½œ â†’ æ¢å¤
old = pyperclip.paste()
pyautogui.hotkey('ctrl', 'c')
new = pyperclip.paste()
pyperclip.copy(old)  # ç«‹å³æ¢å¤
```

### 7.3 çª—å£ç„¦ç‚¹ç®¡ç†

**é—®é¢˜**ï¼šæ‚¬æµ®çª—å¯èƒ½æŠ¢å¤ºç„¦ç‚¹ï¼Œå½±å“ç”¨æˆ·æ“ä½œ

**è§£å†³æ–¹æ¡ˆ**ï¼š

- ä½¿ç”¨ `Qt.WindowType.Tool` æ ‡å¿—
- ä¸æŠ¢å¤ºç„¦ç‚¹ï¼š`self.setAttribute(Qt.WidgetAttribute.WA_ShowWithoutActivating)`
- å¤±å»ç„¦ç‚¹è‡ªåŠ¨éšè—ï¼ˆå¯é€‰ï¼‰

### 7.4 APIè°ƒç”¨å¤±è´¥

**é—®é¢˜**ï¼šç½‘ç»œé—®é¢˜ã€é…é¢è¶…é™ã€æœåŠ¡ä¸å¯ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# é™çº§ç­–ç•¥
try:
    result = await ai_translator.translate(text)
except APIError:
    # é™çº§åˆ°åœ¨çº¿è¯å…¸
    result = await online_dict.translate(text)
except NetworkError:
    # æ˜¾ç¤ºç¼“å­˜ç»“æœæˆ–é”™è¯¯æç¤º
    result = cache.get_last_known(text)
```

### 7.5 æ•°æ®åº“é”

**é—®é¢˜**ï¼šSQLiteå¹¶å‘å†™å…¥å®¹æ˜“é”è¡¨

**è§£å†³æ–¹æ¡ˆ**ï¼š

- ä½¿ç”¨ WAL æ¨¡å¼ï¼š`PRAGMA journal_mode=WAL`
- æ‰¹é‡å†™å…¥
- å¼‚æ­¥é˜Ÿåˆ—

### 7.6 æ‰“åŒ…ä½“ç§¯å¤§

**é—®é¢˜**ï¼šPyQt6 + AIåº“æ‰“åŒ…åå¯èƒ½è¶…è¿‡100MB

**è§£å†³æ–¹æ¡ˆ**ï¼š

- ä½¿ç”¨ UPX å‹ç¼©
- æ’é™¤ä¸å¿…è¦çš„Qtæ¨¡å—
- OCRåº“å¯é€‰å®‰è£…ï¼ˆæ’ä»¶åŒ–ï¼‰

---

## å…«ã€æ‰©å±•æ€§è®¾è®¡

### 8.1 æ’ä»¶ç³»ç»Ÿï¼ˆæœªæ¥ï¼‰

```python
class PluginInterface:
    def on_translation(self, text: str, result: TranslationResult):
        """ç¿»è¯‘å®Œæˆåçš„é’©å­"""
        pass

    def get_custom_translator(self) -> Optional[TranslatorInterface]:
        """è‡ªå®šä¹‰ç¿»è¯‘å™¨"""
        pass

# æ’ä»¶ç¤ºä¾‹ï¼šAnkiè‡ªåŠ¨æ·»åŠ 
class AnkiPlugin(PluginInterface):
    def on_translation(self, text, result):
        if should_add_to_anki(result):
            add_to_anki_deck(text, result.translation)
```

### 8.2 å¤šè¯­è¨€æ”¯æŒ

```
ç¿»è¯‘æ–¹å‘æ”¯æŒçŸ©é˜µï¼š
è‹± â†â†’ ä¸­ï¼ˆä¼˜å…ˆï¼‰
è‹± â†â†’ æ—¥
ä¸­ â†â†’ æ—¥
å…¶ä»–è¯­è¨€é€šè¿‡AIç¿»è¯‘
```

### 8.3 äº‘åŒæ­¥ï¼ˆå¯é€‰ï¼‰

```python
# ä½¿ç”¨ WebDAV / è‡ªå»ºæœåŠ¡å™¨
class SyncService:
    async def sync_up(self):
        """ä¸Šä¼ æœ¬åœ°å˜æ›´"""
        pass

    async def sync_down(self):
        """ä¸‹è½½è¿œç¨‹å˜æ›´"""
        pass
```

---

## ä¹ã€æ€§èƒ½æŒ‡æ ‡

### 9.1 å“åº”æ—¶é—´ç›®æ ‡

- çƒ­é”®å“åº”ï¼š< 100ms
- è¯å…¸ç¿»è¯‘ï¼š< 200ms
- AIç¿»è¯‘ï¼š< 2s
- UIåˆ·æ–°ï¼š60 FPS

### 9.2 èµ„æºå ç”¨

- å†…å­˜ï¼š< 150MBï¼ˆé—²ç½®ï¼‰
- CPUï¼š< 5%ï¼ˆé—²ç½®ï¼‰
- ç£ç›˜ï¼š< 50MBï¼ˆä¸å«è¯å…¸ï¼‰

### 9.3 ç¨³å®šæ€§

- 7Ã—24å°æ—¶ç¨³å®šè¿è¡Œ
- æ— å†…å­˜æ³„æ¼
- å¼‚å¸¸è‡ªåŠ¨æ¢å¤




