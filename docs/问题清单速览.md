# TransLearn 问题清单速览

> 快速参考文档 - 2025-11-17生成

---

## 🔴 未完成功能 (10项)

| # | 功能 | 状态 | 影响 | 工时 |
|---|------|------|------|------|
| 1 | 在线词典翻译器 | ❌ 未实现 | 高 - 降级到AI增加成本 | 4-6h |
| 2 | 发音按钮UI | ⚠️ 代码有但未连接 | 中 - 功能不可用 | 0.5h |
| 3 | 复习系统 | ❌ 框架未完成 | 高 - 核心学习功能 | 12-16h |
| 4 | 标签关联 | ⚠️ 使用JSON非关联表 | 中 - 性能和查询问题 | 6-8h |
| 5 | 导出功能 | ❌ 未实现 | 中 - 配置有代码无 | 8-10h |
| 6 | 备份功能 | ❌ 未实现 | 中 - 数据安全 | 6-8h |
| 7 | Ollama支持 | ❌ 配置有代码无 | 低 - 本地AI可选 | 4-6h |
| 8 | 自定义图标 | ⚠️ 使用默认图标 | 低 - 品牌体验 | 2-3h |
| 9 | 单元测试 | ⚠️ 仅有手动测试 | 中 - 代码质量 | 20-30h |
| 10 | OCR完善 | ⚠️ 框架有待优化 | 低 - 可选依赖 | 6-8h |

---

## ⚠️ 逻辑未闭环 (10项)

| # | 问题 | 文件 | 影响 |
|---|------|------|------|
| 1 | 熟练度从不更新 | `models.py:36-37` | 统计数据无意义 |
| 2 | 查询计数错误 | `translation_service.py:167` | 自动保存失效 |
| 3 | 黑名单未应用 | `context_service.py` | 配置无效 |
| 4 | 统计数据不完整 | `models.py:89-108` | tokens/时长未追踪 |
| 5 | 缓存不清理 | `repository.py:191` | 无限增长 |
| 6 | 配置无热更新 | `config_loader.py` | 需重启应用 |
| 7 | 错误处理不统一 | 多处 | 用户体验差 |
| 8 | 异步音频问题 | `popup_window.py:324` | 可能崩溃 |
| 9 | 复习时间未计算 | `models.py:40-41` | 字段空置 |
| 10 | AI响应无重试 | `ai_translator.py` | 临时故障失败 |

---

## 🔧 需要优化 (15项)

### 性能类 (6项)
1. **DB连接池** - 异常处理和重连机制
2. **分页查询** - 当前全量加载
3. **缓存策略** - 无LRU,只有过期
4. **并发控制** - 配置有代码无
5. **主线程DB** - UI可能卡顿
6. **Token追踪** - 字段有逻辑无

### 代码质量 (5项)
7. **Repository重复** - 需要基类
8. **类型提示** - 部分缺失
9. **代码重复** - 需要重构
10. **日志级别** - 配置未使用
11. **错误码** - 无统一体系

### 用户体验 (4项)
12. **错误提示** - 技术性太强
13. **窗口状态** - 不保存位置
14. **临时文件** - 清理可能失败
15. **学习时长** - 未实现追踪

---

## 🎯 快速优先级

### 立即修复 (本周)
1. ⭐ 发音按钮集成 (30min)
2. ⭐ 黑名单功能 (2-3h)
3. ⭐ 错误提示优化 (4-6h)
4. ⭐ 查询计数修复 (4-6h)

### 高优先级 (2-4周)
1. ⭐ 在线词典 (4-6h)
2. ⭐ 复习系统 (12-16h)
3. ⭐ 熟练度更新 (6-8h)
4. ⭐ 统计完善 (6-8h)

### 中优先级 (1-2月)
1. 📌 导出功能 (8-10h)
2. 📌 备份功能 (6-8h)
3. 📌 标签重构 (6-8h)
4. 📌 性能优化 (10-15h)
5. 📌 单元测试 (20-30h)

---

## 📊 影响分析

### 按影响程度
- **关键** (影响核心功能): 5项
  - 复习系统
  - 熟练度更新
  - 查询计数
  - 在线词典
  - 统计数据

- **重要** (影响体验): 8项
  - 黑名单
  - 错误提示
  - 缓存清理
  - 导出/备份
  - 测试

- **一般** (锦上添花): 12项
  - UI优化
  - 图标
  - 国际化
  - Ollama等

### 按修复成本
- **低成本高价值** (ROI最高): 4项
  - 发音按钮 (30min)
  - 黑名单 (2-3h)
  - 错误提示 (4-6h)
  - Token追踪 (2-3h)

- **中成本高价值**: 5项
  - 在线词典 (4-6h)
  - 查询计数 (4-6h)
  - 熟练度 (6-8h)
  - 缓存优化 (4-6h)
  - 异步修复 (4-6h)

- **高成本高价值**: 3项
  - 复习系统 (12-16h)
  - 导出功能 (8-10h)
  - 单元测试 (20-30h)

---

## 🔍 代码位置索引

### 核心文件
```
src/
├── core/
│   ├── ai_translator.py          # AI翻译 - 需添加Ollama
│   ├── translator_factory.py     # 工厂 - 在线词典返回AI
│   ├── smart_router.py           # 路由 - 逻辑正常
│   ├── pronunciation.py          # 发音 - 异步问题
│   └── [需新建] review_algorithm.py  # SM-2算法
│   └── [需新建] online_dict_translator.py  # 在线词典
│
├── services/
│   ├── translation_service.py    # 服务 - 查询计数错误
│   ├── context_service.py        # 上下文 - 黑名单未用
│   └── [需新建] export_service.py     # 导出
│   └── [需新建] backup_service.py     # 备份
│
├── data/
│   ├── models.py                 # 模型 - 标签用JSON
│   ├── repository.py             # 仓储 - 缓存不清理
│   └── database.py               # DB - 连接池待优化
│
└── ui/
    ├── popup_window.py           # 弹窗 - 发音按钮缺失
    ├── main_window.py            # 主窗 - 状态不保存
    ├── statistics_window.py      # 统计 - 数据不完整
    ├── tray_icon.py              # 托盘 - 默认图标
    └── [需新建] review_window.py      # 复习界面
```

### 配置文件
```
data/config.example.toml
├── [translation.online_dict]     # 配置有实现无
├── [data.export_format]          # 配置有实现无
├── [data.backup_enabled]         # 配置有实现无
├── [performance.max_concurrent]  # 配置有实现无
└── [performance.log_level]       # 配置未使用
```

---

## 📈 项目健康度

| 维度 | 得分 | 说明 |
|------|------|------|
| **功能完整性** | 85/100 | 核心功能完成,部分配置项未实现 |
| **逻辑一致性** | 65/100 | 多处逻辑未闭环,影响实际使用 |
| **代码质量** | 70/100 | 架构好,但缺测试和部分优化 |
| **性能** | 75/100 | 基本够用,有优化空间 |
| **可维护性** | 80/100 | 结构清晰,文档完善 |
| **用户体验** | 75/100 | 基本可用,细节需优化 |

**综合评分**: **75/100** (良好)

---

## 🚀 行动建议

### 本周行动 (投入8-12小时)
```
周一-周二: 发音按钮 + 黑名单功能
周三-周四: 查询计数修复 + 错误提示优化
周五:      测试 + 文档更新
```

### 本月目标 (投入40-60小时)
```
Week 1: 快速修复 (上述)
Week 2: 在线词典 + Token追踪
Week 3: 复习系统开发
Week 4: 测试 + 优化
```

### 季度规划 (投入120-160小时)
```
Month 1: 核心功能补全
Month 2: 性能优化 + 测试
Month 3: 扩展功能 + 文档
```

---

## 📚 相关文档

- 详细分析: `docs/代码审查与开发计划.md`
- 任务清单: `docs/开发任务清单.md`
- 架构设计: `docs/ARCHITECTURE.md`
- 数据库: `docs/DATABASE.md`

---

**快速更新**: 2025-11-17
**下次审查**: 建议每月更新一次

---
